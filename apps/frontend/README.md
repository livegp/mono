# @mono/frontend

🌍 [**Читати українською**](README.ua.md)

Frontend for the Mono project, built with React, Vite, and Bun. This application interacts with the `@mono/backend` API to provide a user interface.

## Table of Contents

- [About The Project](#about-the-project)
- [Built With](#built-with)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
- [Usage](#usage)
  - [Development Mode](#development-mode)
  - [Building for Production](#building-for-production)
  - [Running Production Build](#running-production-build)
  - [Type Checking](#type-checking)
- [API Interaction](#api-interaction)
- [Configuration](#configuration)
  - [Environment Variables](#environment-variables)
- [Vite Configuration](#vite-configuration)
- [Docker](#docker)
  - [Building the Image](#building-the-image)
  - [Running the Container](#running-the-container)
- [Project Structure](#project-structure)
- [License](#license)

## About The Project

This project serves as the frontend user interface for the Mono application. It is developed using React and Vite, running on the Bun runtime. It focuses on providing a modern, responsive, and efficient user experience.

Key features include:

- Reactive UI components built with React.
- Fast development and build times powered by Vite and Bun.
- Typed API client for interaction with the backend using Eden Treaty.
- Environment variable management with validation.
- Comprehensive Vite plugin ecosystem for optimization, security, and developer experience.

## Built With

- [Bun](https://bun.sh/) - JavaScript runtime & toolkit
- [Vite](https://vitejs.dev/) - Frontend build tool
- [React](https://react.dev/) - JavaScript library for building user interfaces
- [TypeScript](https://www.typescriptlang.org/) - Typed JavaScript
- [@ap0nia/eden-react-query](https://www.npmjs.com/package/@ap0nia/eden-react-query) (Eden Treaty with React Query) - Typed API client for Elysia.js backend
- [@tanstack/react-query](https://tanstack.com/query/latest) - Data-fetching and state management
- [Valibot](https://valibot.dev/) - Schema validation (used for environment variables)
- Various Vite plugins (see [Vite Configuration](#vite-configuration) section)

## Getting Started

Follow these instructions to get a copy of the project up and running on your local machine for development and testing purposes.

### Prerequisites

Ensure you have [Bun](https://bun.sh/docs/installation) installed on your system.

### Installation

1. Clone the monorepo (if you haven't already).
2. Navigate to the frontend directory:

    ```bash
    cd apps/frontend
    ```

3. Install dependencies:

    ```bash
    bun install
    ```

## Usage

### Development Mode

To run the frontend development server with hot-reloading:

```bash
bun run dev
```

This command starts the Vite development server. The application will typically be accessible at the URL specified by `VITE_WEB_URL` or `http://localhost:<VITE_WEB_PORT>`. Check the console output for the exact URL.

### Building for Production

To build the application for production:

```bash
bun run build
```

This command uses Vite to create an optimized build in the `dist/` directory.

### Running Production Build

After building the project, you can preview the production build locally:

```bash
bun run preview
```

This command uses Vite to serve the `dist/` folder. For actual production deployment, you would typically use the Docker image or serve the static files from the `dist/` directory with a production-grade static file server.

### Type Checking

To check for TypeScript errors without emitting JavaScript files:

```bash
bun run check-types
```

## API Interaction

The frontend interacts with the `@mono/backend` API using a typed client generated by Eden Treaty, integrated with React Query via `@ap0nia/eden-react-query`.

- The Eden client is initialized in `src/lib/eden.ts`.
- It connects to the backend API, typically defined by `VITE_API_URL` and `VITE_API_PORT`.
- An example of its usage can be found in `src/App.tsx`, where it fetches a greeting message from the `/api/greet` endpoint.

## Configuration

### Environment Variables

The application uses environment variables for configuration. These are loaded by Vite and validated using `@julr/vite-plugin-validate-env` with a schema defined in `config/env.ts` using Valibot.

Create a `.env` file in the `apps/frontend` directory. You can base it on `.env.example` if one exists, or create it from scratch.

Key environment variables:

- `VITE_WEB_PORT`: The port for the Vite development server (e.g., `5173`).
- `VITE_WEB_URL`: The base URL for the web application (e.g., `http://localhost:5173`).
- `VITE_API_PORT`: The port where the backend API is running (e.g., `3001`).
- `VITE_API_URL`: The base URL for the backend API (e.g., `http://localhost`).
- `VITE_CORS_ORIGIN`: Allowed origins for CORS, typically matching `VITE_WEB_URL`.

Example `.env` file:

```env
VITE_WEB_PORT=5173
VITE_WEB_URL=http://localhost:5173
VITE_API_PORT=3001
VITE_API_URL=http://localhost
VITE_CORS_ORIGIN=http://localhost:5173
```

## Vite Configuration

The `vite.config.ts` file configures the Vite build tool and its plugins. Key plugins used include:

- `@vitejs/plugin-react-swc`: Enables React support using SWC.
- `vite-tsconfig-paths`: Allows using TypeScript path aliases.
- `vite-plugin-checker`: Performs TypeScript and Biome (linter/formatter) checks during development.
- `vite-plugin-compression`: Compresses assets (e.g., gzip, brotli) for smaller bundle sizes.
- `vite-imagetools`: Optimizes images and allows for advanced image transformations.
- `vite-plugin-bun-csp` / `vite-plugin-csp-guard`: Helps generate Content Security Policy (CSP) headers.
- `vite-plugin-hashed-favicons`: Generates favicons for various platforms and a web manifest file.
- `vite-plugin-open-graph`: Adds Open Graph meta tags for better social media sharing.
- `vite-plugin-sitemap`: Generates a `sitemap.xml` file.
- `vite-plugin-svg-spritemap`: Creates an SVG spritemap from individual SVG files.
- `vite-plugin-webfont-dl`: Downloads and embeds web fonts from services like Google Fonts.
- `@julr/vite-plugin-validate-env`: Validates environment variables against a defined schema.
- **Server Proxy:** Configures a proxy for API requests (e.g., `/api` to `VITE_API_URL:VITE_API_PORT`) during development to avoid CORS issues.

## Docker

This project uses an optimized multi-stage Dockerfile with **Turbo Prune** for efficient monorepo builds. The Dockerfile creates minimal workspaces containing only necessary dependencies for faster builds and smaller images.

### Building the Image

```bash
# From the monorepo root
docker build --build-arg PROJECT=frontend -t mono-frontend .

# Or using docker-compose
docker-compose build frontend
```

### Running the Container

```bash
# Run standalone container
docker run -p 4173:4173 mono-frontend

# Or using docker-compose
docker-compose up frontend
```

### Docker Configuration Features

- **Multi-stage build**: BASE → PRUNE → INSTALLER → RUNNER
- **Turbo Prune**: Creates minimal workspace with only necessary dependencies
- **Security**: Runs as non-privileged user
- **Health Check**: Automatic server health monitoring on port 4173
- **Optimization**: Dependency caching for faster rebuilds
- **Static files**: Serves built static files for production
- **Production ready**: Optimized for production deployment

### Docker Architecture

The Dockerfile uses a **4-stage build process** optimized for Turborepo monorepos:

1. **Prune Stage**: Uses `turbo prune @mono/frontend --docker` to create a minimal workspace with only necessary dependencies
2. **Installer Stage**: Installs dependencies from the pruned workspace and builds the application using `turbo build --filter=@mono/frontend`
3. **Runner Stage**: Creates the final runtime image with minimal footprint

**Benefits of Turbo Prune:**

- ⚡ **Faster builds** - Only processes relevant files
- 🗜️ **Smaller images** - Excludes unnecessary packages and files
- 🚀 **Better caching** - More granular layer invalidation
- 🎯 **Precise dependencies** - Only includes what's actually needed

The build process includes proper caching, minimal dependencies, and security best practices with non-root user execution.

## Project Structure

A brief overview of the key directories and files:

```plaintext
mono/apps/frontend/
├── 404.html            # Custom 404 page for SPA routing
├── Dockerfile          # Docker configuration
├── README.md           # This file
├── README.ua.md        # Ukrainian version of this file
├── config/
│   └── env.ts          # Schema definition for environment variable validation (Valibot)
├── index.html          # Main HTML entry point for the Vite application
├── package.json        # Project metadata, dependencies, and scripts
├── public/             # Static assets that are copied directly to the build output
│   └── vite.svg        # Example static asset
├── src/
│   ├── App.css         # CSS styles for the main App component
│   ├── App.tsx         # Main React application component
│   ├── assets/         # Static assets like images, icons, fonts
│   │   ├── icons/      # SVG icons (e.g., for spritemaps or favicons)
│   │   ├── img/        # Image files
│   │   └── react.svg   # React logo asset
│   ├── index.css       # Global CSS styles
│   ├── lib/            # Utility functions, libraries, or client configurations
│   │   └── eden.ts     # Eden Treaty client setup for backend API interaction
│   ├── main.tsx        # Main entry point for the React application
│   └── vite-env.d.ts   # TypeScript definitions for Vite-specific environment variables
├── tsconfig.app.json   # TypeScript configuration specific to the application code (src)
├── tsconfig.json       # Root TypeScript configuration, often referencing other tsconfig files
├── tsconfig.node.json  # TypeScript configuration for Node.js specific files (e.g., vite.config.ts)
├── vite.config.ts      # Vite configuration file
└── dist/               # Output directory for production builds (generated)
```

## License

This project is licensed under the MIT License. See the [LICENSE](../../LICENSE.md) file in the monorepo root for details.

**What this license allows:**

- Commercial use
- Modification
- Distribution
- Private use
- Sublicensing

**Limitations:**

- No liability
- No warranty
